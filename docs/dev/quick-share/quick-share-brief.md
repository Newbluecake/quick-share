# Quick Share - 需求简报

> **生成时间**: 2026-01-12
> **访谈轮次**: 第 3 轮
> **细节级别**: standard
> **版本**: v1 Final

## 1. 一句话描述

快速启动HTTP服务分享单个文件，自动生成适合curl/wget的下载链接，支持局域网访问。

## 2. 目标用户

- 主要用户：开发者、技术人员，需要在局域网内快速分享文件给其他设备
- 使用场景：服务器间传输文件、临时分享日志文件、快速分享构建产物

## 3. 核心场景（Top 3）

### 场景 1: 快速分享单个文件
- **触发**: 用户执行 `quick-share /path/to/file.zip`
- **结果**:
  - 启动HTTP服务器
  - 检测本机局域网IP（如 192.168.1.100）
  - 自动选择可用端口（默认8000，冲突则递增）
  - 输出下载链接和curl/wget命令

### 场景 2: 命令行工具下载
- **触发**: 其他机器执行显示的 `curl http://192.168.1.100:8000/file.zip -O`
- **结果**: 直接下载文件，服务器记录下载次数

### 场景 3: 浏览器访问下载
- **触发**: 用户在浏览器访问 `http://192.168.1.100:8000/file.zip`
- **结果**: 浏览器触发文件下载

## 4. 关键需求点

**必须有 (P0)**:
- [ ] 自动检测局域网IP地址（排除127.0.0.1和虚拟网卡）
- [ ] 自动选择可用端口（8000起，冲突则递增到8001、8002...）
- [ ] 仅允许下载指定文件，禁止访问其他路径（路径安全）
- [ ] 生成适合curl/wget的直接下载链接
- [ ] 支持浏览器访问下载

**应该有 (P1)**:
- [ ] 下载次数限制（可配置，默认10次后自动关闭）
- [ ] 运行时长限制（可配置，默认5分钟后自动关闭）
- [ ] 显示下载进度/日志（谁在什么时间下载了文件）
- [ ] 支持通过命令行参数自定义端口、下载次数、超时时间

## 5. 明确不做

- 不支持分享整个目录的文件列表（仅支持单个文件）
- 不支持多文件同时分享（一次只能分享一个文件）
- 不生成二维码（暂时排除，可作为future feature）
- 不支持外网访问（仅局域网，不涉及NAT穿透、端口映射）
- 不做文件上传功能（只读服务器）
- 不做身份认证（信任局域网环境）

## 6. 关键风险

- **多网卡环境下IP选择问题** → 自动选择优先级：以太网 > WiFi > 其他，排除虚拟网卡（docker、vmware等）
- **端口冲突** → 自动递增机制，最多尝试100个端口（8000-8099），全部占用则报错
- **路径遍历攻击** → 严格验证请求路径，只允许下载指定文件的basename，禁止 `../` 等路径操作
- **文件被移动或删除** → 启动时检查文件是否存在，服务运行期间如果文件被删除则返回404

## 7. 下一步

✅ **确认 Brief 后，查看完整 Requirements**:
`quick-share/docs/dev/quick-share/quick-share-requirements.md`

✅ **在新会话中执行**:
```bash
/dev:spec-dev quick-share --skip-requirements
```

这将基于 requirements.md 进行：
1. 技术设计（选择语言、HTTP库、IP检测方法）
2. 任务拆分（CLI入口、HTTP服务器、工具函数、测试）
3. TDD 实施（测试驱动开发）
