# Directory Sharing - 需求简报

> **生成时间**: 2026-01-14
> **访谈轮次**: 第 3 轮
> **细节级别**: standard
> **版本**: v1 Final

## 1. 一句话描述

扩展 Quick Share 以支持共享整个目录，允许接收者通过 Web 界面浏览文件或下载整个目录的压缩包。

## 2. 目标用户

- **主要用户**: 开发者需要与团队成员共享项目文件夹进行协作或代码审查
- **次要用户**: 一般用户需要共享多个相关文件（照片、文档集合等）

## 3. 核心场景（Top 3）

### 场景 1: 共享项目目录供代码审查
- **触发**: 开发者执行 `quick-share ./my-project`
- **结果**:
  - 系统自动检测这是一个目录
  - 生成 Web 界面链接显示目录结构
  - 接收者可以浏览文件列表、点击查看/下载单个文件
  - 接收者可以选择下载整个目录为 zip 文件

### 场景 2: 按会话限制访问
- **触发**: 开发者设置 `quick-share ./docs -n 3`
- **结果**:
  - 系统允许 3 个独立的浏览会话（而非 3 次文件下载）
  - 每个会话可以浏览多个文件
  - 达到 3 个会话后服务器自动停止

### 场景 3: 安全沙箱访问
- **触发**: 接收者尝试访问 `http://192.168.1.10:8000/../../../etc/passwd`
- **结果**:
  - 系统检测路径遍历攻击
  - 拒绝访问，仅允许访问共享目录内的文件
  - 记录安全事件到日志

## 4. 关键需求点

**必须有 (P0)**:
- [ ] 自动检测输入路径是文件还是目录
- [ ] 目录沙箱机制：防止访问共享目录之外的文件
- [ ] Web 文件浏览界面（显示文件列表、大小、修改时间）
- [ ] 下载整个目录为 zip 的选项
- [ ] 按会话计数的下载限制（而非按文件）
- [ ] 所有现有功能适用（端口、超时、自定义限制）

**应该有 (P1)**:
- [ ] 子目录导航支持（在沙箱内）
- [ ] 文件预览功能（文本文件、图片等）
- [ ] 目录大小统计和显示
- [ ] 实时显示活跃会话数量

## 5. 明确不做

- **不支持上传**: 这是单向共享工具，不支持接收者上传文件
- **不支持编辑**: 接收者不能修改、删除或重命名文件
- **不支持父目录访问**: 严格限制在共享目录及其子目录内
- **不支持认证/密码**: 保持轻量级，任何有链接的人都可以访问

## 6. 关键风险

- **路径遍历安全风险** → 强化 security.py 的验证逻辑，添加单元测试覆盖所有攻击向量
- **大目录性能问题** → 限制单次列表数量，添加分页或虚拟滚动
- **Zip 打包内存消耗** → 使用流式压缩，避免将整个目录加载到内存
- **向后兼容性** → 确保现有单文件共享功能不受影响，所有现有测试通过

## 7. 下一步

✅ **确认 Brief 后，查看完整 Requirements**:
`docs/dev/directory-sharing/directory-sharing-requirements.md`

✅ **在新会话中执行**:
```bash
/dev:spec-dev directory-sharing --skip-requirements
```

这将基于 requirements.md 进行：
1. 技术设计
2. 任务拆分
3. TDD 实施
